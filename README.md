# -
基于Django+Mysql的校园图书借阅管理系统
# 校园图书借阅管理系统功能需求分析

## 1. 核心功能需求分析

系统需要实现图书借阅管理的核心业务流程，包括图书的生命周期管理和用户的借阅行为管理。

### 1.1. 图书管理功能

| 功能模块 | 描述 | 角色权限 | 技术要求 |
| :--- | :--- | :--- | :--- |
| **图书信息录入** | 录入新书信息，包括书名、作者、ISBN、出版社、分类、总数量、可借阅数量等。 | 管理员 | 需进行数据校验，防止SQL注入。 |
| **图书信息查询** | 支持多维度模糊查询（书名、作者、ISBN、分类等），支持分页展示。 | 所有用户 | 需优化数据库查询性能（Django ORM）。 |
| **图书信息修改/删除** | 对已有图书信息进行编辑和下架操作。 | 管理员 | 需记录操作日志，防止误操作。 |
| **批量导入** | 支持通过Excel/CSV等文件批量导入图书信息。 | 管理员 | 需处理文件上传和解析，确保数据格式正确性。 |

### 1.2. 借阅/归还管理功能

| 功能模块 | 描述 | 角色权限 | 技术要求 |
| :--- | :--- | :--- | :--- |
| **图书借阅** | 学生通过学号/卡号和图书ISBN/条码进行借阅登记，系统自动检查可借阅数量、用户借阅上限、用户状态（如是否有逾期未还记录）。 | 学生/管理员 | 事务性操作，确保库存数量和借阅记录同步更新。 |
| **图书归还** | 登记图书归还，系统自动更新库存数量，并检查是否逾期。 | 学生/管理员 | 事务性操作，需计算逾期天数和罚款金额。 |
| **借阅记录查询** | 查询个人或所有用户的历史借阅、当前借阅、逾期记录。 | 学生（个人）/管理员（全部） | 需支持按时间、状态等条件筛选。 |
| **续借功能** | 允许在规定期限内进行续借，系统自动更新应还日期。 | 学生 | 需限制续借次数和续借条件（如不能有预约）。 |

### 1.3. 逾期管理功能

| 功能模块 | 描述 | 角色权限 | 技术要求 |
| :--- | :--- | :--- | :--- |
| **逾期状态标记** | 系统每日定时任务检查所有借阅记录，对超过应还日期的记录标记为“逾期”。 | 系统自动 | Django定时任务（如Celery或内置管理命令）。 |
| **逾期罚款计算** | 根据系统设定的规则（如每日罚款金额）自动计算罚款总额。 | 系统自动 | 确保计算逻辑准确，并记录罚款明细。 |
| **逾期提醒** | 通过邮件、站内信或短信等方式提醒用户归还图书和缴纳罚款。 | 系统自动 | 需集成外部通知服务。 |

## 2. 用户权限控制（RBAC）模型分析

系统采用基于角色的访问控制（RBAC）模型，将功能权限分配给角色，再将角色分配给用户。

### 2.1. 角色定义与权限划分

| 角色名称 | 角色描述 | 核心权限（功能） |
| :--- | :--- | :--- |
| **管理员 (Admin)** | 系统的最高权限用户，负责系统配置、用户管理、图书管理和数据统计。 | 用户管理（增删改查）、图书管理（增删改查）、借阅记录管理、系统配置、数据统计。 |
| **学生 (Student)** | 系统的主要用户，负责图书查询、借阅、归还、续借和查看个人借阅记录。 | 图书查询、借阅、归还、续借、个人信息修改、个人借阅记录查询。 |
| **（可选）图书管理员 (Librarian)** | 负责日常借阅、归还操作，无系统配置权限。 | 图书管理（增删改查）、借阅/归还操作、逾期记录查询。 |

### 2.2. 权限控制实现要求

1. **前端控制**: 根据用户角色，动态展示或隐藏菜单和操作按钮。
2. **后端校验**: **核心安全机制**。所有API接口在执行业务逻辑前，必须严格校验当前用户是否拥有该操作的权限。
3. **Django实现**: 利用Django内置的`auth`模块和`permission`系统，结合自定义的`Group`（角色）和`Permission`（权限）进行精细化控制。

## 3. 敏感数据安全存储需求分析

敏感数据（如学生姓名、学号、联系方式等）的存储必须满足加密要求，以应对数据泄露风险。

### 3.1. 数据加密存储

1. **数据类型**: 涉及学生/用户表的敏感字段（如`name`、`phone`、`email`、`student_id`等）。
2. **加密方式**: 推荐使用**不可逆的哈希算法**（如`bcrypt`或`Argon2`）存储密码。对于需要查询和解密的敏感信息（如学号、联系方式），可采用**对称加密算法**（如AES），密钥需妥善保管。
3. **功能影响**:
    * **录入**: 在数据写入数据库前，必须进行加密处理。
    * **查询**: 在查询敏感数据时，需要先从数据库取出密文，再进行解密展示给有权限的用户（如管理员）。
    * **查询条件**: 如果需要通过加密字段进行查询（如通过学号查询用户），则需要考虑**可搜索加密**或使用**哈希索引**等技术，避免全表解密扫描。

### 3.2. 数据脱敏展示

在非必要场景（如管理员查看借阅记录列表），应对敏感数据进行脱敏处理（如手机号显示为`138****1234`），进一步保护用户隐私。

## 4. 跨站脚本（XSS）攻击防护需求分析

XSS攻击主要发生在数据输入和数据展示环节。系统必须对所有用户输入进行严格处理。

### 4.1. 输入数据过滤与校验

1. **严格校验**: 对所有用户输入（包括图书信息、用户备注、查询关键词等）进行类型、长度和格式的严格校验。
2. **输入过滤**: 在数据存储到数据库之前，对输入内容进行**HTML标签和特殊字符的过滤**，特别是`<script>`、`<iframe>`等标签。

### 4.2. 输出数据转义

1. **默认转义**: 在数据从数据库取出并渲染到前端页面时，必须对所有用户生成的内容进行**HTML实体转义**（Escaping）。
2. **Django模板特性**: Django的模板系统默认会对变量进行转义，但开发者必须确保在自定义模板标签或使用`safe`过滤器时，不会引入安全漏洞。

## 5. 技术因素（Django + MySQL）对功能实现的影响

系统采用Django作为Web框架，MySQL作为数据库，这对功能实现提出了具体的技术要求和优势。

### 5.1. Django框架优势与要求

| 方面 | 影响与要求 |
| :--- | :--- |
| **ORM操作** | 使用Django ORM进行数据库操作，避免直接编写SQL，天然防止SQL注入。要求开发者熟悉ORM的查询优化（`select_related`、`prefetch_related`）。 |
| **后台管理** | 利用Django Admin快速搭建管理员后台，实现基础的增删改查功能，提高开发效率。 |
| **会话管理** | 利用Django Session和Cookie机制实现用户登录状态管理和权限控制。 |
| **表单处理** | 利用Django Forms进行数据校验和清洗，结合XSS防护要求，确保输入数据的安全性。 |

### 5.2. MySQL数据库要求

| 方面 | 影响与要求 |
| :--- | :--- |
| **事务支持** | 借阅和归还操作是典型的事务场景，必须确保原子性（要么都成功，要么都失败）。要求使用支持事务的存储引擎（如InnoDB）。 |
| **数据类型** | 敏感数据加密后，其存储字段类型可能需要调整（如从`VARCHAR`到`BLOB`或更长的`VARCHAR`）。 |
| **性能优化** | 针对图书查询、借阅记录查询等高频操作，需合理设计索引（如ISBN、学号、借阅状态等字段），以保证查询效率。 |

## 6. 数据统计与管理功能需求

管理员需要通过数据统计功能，掌握系统的运行状态和资源利用情况。

| 功能模块 | 描述 | 角色权限 |
| :--- | :--- | :--- |
| **图书统计** | 统计图书总数、可借阅数量、各分类图书数量分布、热门图书排行（按借阅次数）。 | 管理员 |
| **用户统计** | 统计注册用户总数、活跃用户数、逾期用户数、用户借阅量排行。 | 管理员 |
| **借阅趋势分析** | 按日/周/月统计借阅量和归还量，以图表形式展示系统运行趋势。 | 管理员 |
| **系统日志管理** | 记录用户登录、借阅、归还、管理员操作等关键行为日志，支持查询和导出。 | 管理员 |

---

**总结**:

该校园图书借阅管理系统不仅需要实现基础的业务功能（借阅、归还、查询），更需要将**安全性和权限控制**融入到每一个功能模块的设计中。Django和MySQL的组合为快速开发和实现这些安全特性提供了良好的技术基础。

**启动**
python manage.py runserver 0.0.0.0:8000
